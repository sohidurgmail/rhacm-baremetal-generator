---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: {{ rhcos_name }}
  namespace: {{ infraenv_namespace }}
  labels:
    infraenvs.agent-install.openshift.io: {{ multicluster_engine_managed_cluster.cluster_name }}
    cluster-name: {{ multicluster_engine_managed_cluster.cluster_name }}
{% if role == 'master' %}
    node-role.kubernetes.io/master: ""
{% elif role == 'worker' %}
    node-role.kubernetes.io/worker: ""
{% endif %}
spec:
  online: true
  bootMACAddress: '{{ ilo_mac }}'
  bmc:
    # Build the Redfish virtual media URL from the iLO IP
    address: 'redfish-virtualmedia://{{ ilo_ip }}/redfish/v1/Systems/1'
    # Single shared secret for all nodes
    credentialsName: bmc-secret
    disableCertificateVerification: true
  rootDeviceHints:
    deviceName: "/dev/sda"
